## RKE2 클러스터 인증서 갱신 시 유의사항

#### 문제점

1. rke2 certificate rotate 후 rke2-server 재기동 시 기존의 etcd 프로세스가 종료되지 않고 남아 있어 start가 되지 않는 현상 발생
2. 신규 rke2 서비스가 기동되나, 기존 etcd 서비스가 떠 있어 기존 etcd로 신규 갱신된 인증서로 접속하려고 하고, 인증서 오류로 접속 불가
3. etcd 가 접속되지 않아 api 서버 및 기타 서비스가 정상 기동 불가능
4. rke2 server 기동이 완료되지 않고 hang 걸린 상태 계속
5. Agent가 많이 연결되어 있는 경우 지속적으로 api 서버 접속을 시도하나 연결 불가 오류 발생

#### 해결 방안

1. 인증서 갱신 대상이 되는 노드의 rke2 서비스를 정상적으로 종료한다.
2. 서비스 종료 후 etcd 등 컨테이너로 기동된 서비스 프로세스가 남아 있지 않은지 확인한다.
3. 잔여 서비스가 남아 있다면 종료한다. 해당 노드를 reboot 하는것이 확실할 것 같다.
4. rke2 마스터 노드의 인증서를 갱신한다.
5. rke2 마스터 노드의 서비스를 재기동 한다.
6. rke2 agent 노드의 서비스를 순차적으로 재기동 한다.

